<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js lfe-pdp">

<head>
    <!-- Book generated using mdBook -->
    <meta charset="UTF-8">
    <title>Organizing Things with Records - Casting SPELs in LFE</title>
    
    


    <!-- Custom HTML head -->
    


    <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
    <meta name="description" content="The LFE Edition of the Classic Lisp Comic Book">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#ffffff" />

    <link rel="icon" href="../favicon.svg">
    <link rel="shortcut icon" href="../favicon.png">
    <link rel="stylesheet" href="../css/variables.css">
    <link rel="stylesheet" href="../css/general.css">
    <link rel="stylesheet" href="../css/chrome.css">
    <link rel="stylesheet" href="../css/print.css" media="print">

    <!-- Fonts -->
    <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
    
    <link rel="stylesheet" href="../fonts/fonts.css">
    

    <!-- Highlight.js Stylesheets -->
    <link rel="stylesheet" href="../highlight.css">
    <link rel="stylesheet" href="../tomorrow-night.css">
    <link rel="stylesheet" href="../ayu-highlight.css">

    <!-- Custom theme stylesheets -->
    
    <link rel="stylesheet" href="../css/custom.css">
    

    
</head>

<body>
    <!-- Provide site root to javascript -->
    <script type="text/javascript">
        var path_to_root = "../";
        var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "lfe-pdp" : "lfe-pdp";
    </script>

    <!-- Work around some values being stored in localStorage wrapped in quotes -->
    <script type="text/javascript">
        try {
            var theme = localStorage.getItem('mdbook-theme');
            var sidebar = localStorage.getItem('mdbook-sidebar');

            if (theme.startsWith('"') && theme.endsWith('"')) {
                localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
            }

            if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
            }
        } catch (e) { }
    </script>

    <!-- Set the theme before any content is loaded, prevents flash -->
    <script type="text/javascript">
        var theme;
        try { theme = localStorage.getItem('mdbook-theme'); } catch (e) { }
        if (theme === null || theme === undefined) { theme = default_theme; }
        var html = document.querySelector('html');
        html.classList.remove('no-js')
        html.classList.remove('lfe-pdp')
        html.classList.add(theme);
        html.classList.add('js');
    </script>

    <!-- Hide / unhide sidebar before it is displayed -->
    <script type="text/javascript">
        var html = document.querySelector('html');
        var sidebar = 'hidden';
        if (document.body.clientWidth >= 1080) {
            try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch (e) { }
            sidebar = sidebar || 'visible';
        }
        html.classList.remove('sidebar-visible');
        html.classList.add("sidebar-" + sidebar);
    </script>

    <nav id="sidebar" class="sidebar" aria-label="Table of contents">
        <div class="sidebar-scrollbox">
            <ol class="chapter"><li class="chapter-item expanded "><a href="../index.html"><strong aria-hidden="true">1.</strong> Casting SPELs in LFE</a></li><li class="chapter-item expanded "><a href="../front-matter/copyright-page.html"><strong aria-hidden="true">2.</strong> Copyright Page</a></li><li class="chapter-item expanded "><a href="../introduction/index.html"><strong aria-hidden="true">3.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../part1/index.html"><strong aria-hidden="true">4.</strong> Getting Started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../part1/1-setup.html"><strong aria-hidden="true">4.1.</strong> Getting Set Up</a></li><li class="chapter-item expanded "><a href="../part1/2-synsem.html"><strong aria-hidden="true">4.2.</strong> Syntax and Semantics</a></li></ol></li><li class="chapter-item expanded "><a href="../part2/index.html"><strong aria-hidden="true">5.</strong> Introducing the Game</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../part2/1-lay.html"><strong aria-hidden="true">5.1.</strong> Lay of the Land</a></li><li class="chapter-item expanded "><a href="../part2/2-funcs.html"><strong aria-hidden="true">5.2.</strong> Introducing Functions</a></li></ol></li><li class="chapter-item expanded "><a href="../part3/index.html"><strong aria-hidden="true">6.</strong> Getting Functional</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../part3/1-glob.html"><strong aria-hidden="true">6.1.</strong> Global State</a></li><li class="chapter-item expanded "><a href="../part3/2-nonglob.html"><strong aria-hidden="true">6.2.</strong> A Non-global Alternative</a></li><li class="chapter-item expanded "><a href="../part3/3-fp.html"><strong aria-hidden="true">6.3.</strong> The Functional Programming Style</a></li></ol></li><li class="chapter-item expanded "><a href="../part4/index.html"><strong aria-hidden="true">7.</strong> Game World Data</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../part4/1-records.html" class="active"><strong aria-hidden="true">7.1.</strong> Organizing Things with Records</a></li><li class="chapter-item expanded "><a href="../part4/2-map.html"><strong aria-hidden="true">7.2.</strong> Making the Game State</a></li><li class="chapter-item expanded "><a href="../part4/3-recfuncs.html"><strong aria-hidden="true">7.3.</strong> Records Functions</a></li></ol></li><li class="chapter-item expanded "><a href="../part5/index.html"><strong aria-hidden="true">8.</strong> Looking Around in our Game World</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../part5/1-location.html"><strong aria-hidden="true">8.1.</strong> Location, Location, Location</a></li><li class="chapter-item expanded "><a href="../part5/2-patts.html"><strong aria-hidden="true">8.2.</strong> Thinking in Patterns</a></li><li class="chapter-item expanded "><a href="../part5/3-exits.html"><strong aria-hidden="true">8.3.</strong> Exits</a></li><li class="chapter-item expanded "><a href="../part5/4-finding.html"><strong aria-hidden="true">8.4.</strong> Finding Things</a></li><li class="chapter-item expanded "><a href="../part5/5-looking.html"><strong aria-hidden="true">8.5.</strong> Putting These Pieces Together</a></li></ol></li><li class="chapter-item expanded "><a href="../part6/index.html"><strong aria-hidden="true">9.</strong> Casting SPELs</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../part6/1-walking.html"><strong aria-hidden="true">9.1.</strong> Walking Around In Our World</a></li><li class="chapter-item expanded "><a href="../part6/2-spels.html"><strong aria-hidden="true">9.2.</strong> Introducing SPELs</a></li><li class="chapter-item expanded "><a href="../part6/3-interact.html"><strong aria-hidden="true">9.3.</strong> Interacting</a></li><li class="chapter-item expanded "><a href="../part6/4-cmplx.html"><strong aria-hidden="true">9.4.</strong> Complex Interactions</a></li><li class="chapter-item expanded "><a href="../part6/5-spacts.html"><strong aria-hidden="true">9.5.</strong> Creating Special Actions</a></li><li class="chapter-item expanded "><a href="../part6/6-winact.html"><strong aria-hidden="true">9.6.</strong> The Winning Move</a></li></ol></li><li class="chapter-item expanded "><a href="../part7/index.html"><strong aria-hidden="true">10.</strong> Adding a Simple Game Server</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../part7/1-state.html"><strong aria-hidden="true">10.1.</strong> The Problem of State</a></li><li class="chapter-item expanded "><a href="../part7/2-closures.html"><strong aria-hidden="true">10.2.</strong> A Glance at Closures</a></li><li class="chapter-item expanded "><a href="../part7/3-processes.html"><strong aria-hidden="true">10.3.</strong> Light-weight Processes as Closures</a></li><li class="chapter-item expanded "><a href="../part7/4-server.html"><strong aria-hidden="true">10.4.</strong> Making a Game Server</a></li><li class="chapter-item expanded "><a href="../part7/5-commands.html"><strong aria-hidden="true">10.5.</strong> Supporting Commands</a></li></ol></li><li class="chapter-item expanded "><a href="../part8/index.html"><strong aria-hidden="true">11.</strong> Let's Play!</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../part8/1-win.html"><strong aria-hidden="true">11.1.</strong> Playing to Win</a></li><li class="chapter-item expanded "><a href="../part8/2-lose.html"><strong aria-hidden="true">11.2.</strong> Playing to Lose</a></li><li class="chapter-item expanded "><a href="../part8/3-next.html"><strong aria-hidden="true">11.3.</strong> What's Next?</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="../addenda/index.html"><strong aria-hidden="true">12.</strong> Addenda</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../addenda/1-changes.html"><strong aria-hidden="true">12.1.</strong> Changes from the Original</a></li><li class="chapter-item expanded "><a href="../addenda/2-whyspels.html"><strong aria-hidden="true">12.2.</strong> The Case Against the Word &quot;Macro&quot;</a></li><li class="chapter-item expanded "><a href="../addenda/3-otp.html"><strong aria-hidden="true">12.3.</strong> Using OTP</a></li><li class="chapter-item expanded "><a href="../addenda/4-source.html"><strong aria-hidden="true">12.4.</strong> Source Code</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="../feedback.html">Feedback</a></li><li class="chapter-item expanded affix "><a href="../redirects/docs.html">LFE Documentation</a></li><li class="chapter-item expanded affix "><a href="../redirects/mdbook.html">Built with mdBook</a></li></ol>
        </div>
        <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
    </nav>

    <div id="page-wrapper" class="page-wrapper">

        <div class="page">
            
            <div id="menu-bar-hover-placeholder"></div>
            <div id="menu-bar" class="menu-bar sticky bordered">
                <div class="left-buttons">
                    <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents"
                        aria-label="Toggle Table of Contents" aria-controls="sidebar">
                        <i class="fa fa-bars"></i>
                    </button>
                    <button id="theme-toggle" class="icon-button" type="button" title="Change theme"
                        aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                        <i class="fa fa-paint-brush"></i>
                    </button>
                    <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                        <li role="none"><button role="menuitem" class="theme"
                                id="lfe-pdp">LFE PDP</button></li>
                        <li role="none"><button role="menuitem" class="theme"
                                id="light">Light</button></li>
                        <li role="none"><button role="menuitem" class="theme"
                                id="rust">Rust</button></li>
                        <li role="none"><button role="menuitem" class="theme"
                                id="coal">Coal</button></li>
                        <li role="none"><button role="menuitem" class="theme"
                                id="navy">Navy</button></li>
                        <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button>
                        </li>
                    </ul>
                    
                    <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)"
                        aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S"
                        aria-controls="searchbar">
                        <i class="fa fa-search"></i>
                    </button>
                    
                </div>

                <h1 class="menu-title">Casting SPELs in LFE</h1>

                <div class="right-buttons">
                    <a href="../print.html" title="Print this book" aria-label="Print this book">
                        <i id="print-button" class="fa fa-print"></i>
                    </a>
                    
                    <a href="https://github.com/lfe/casting-spels/" title="Git repository" aria-label="Git repository">
                        <i id="git-repository-button" class="fa fa-github"></i>
                    </a>
                    
                </div>
            </div>

            
            <div id="search-wrapper" class="hidden">
                <form id="searchbar-outer" class="searchbar-outer">
                    <input type="search" name="search" id="searchbar" name="searchbar"
                        placeholder="Search this book ..." aria-controls="searchresults-outer"
                        aria-describedby="searchresults-header">
                </form>
                <div id="searchresults-outer" class="searchresults-outer hidden">
                    <div id="searchresults-header" class="searchresults-header"></div>
                    <ul id="searchresults">
                    </ul>
                </div>
            </div>
            

            <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
            <script type="text/javascript">
                document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                Array.from(document.querySelectorAll('#sidebar a')).forEach(function (link) {
                    link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                });
            </script>

            <div id="content" class="content">
                <main>
                    <h2><a class="header" href="#organizing-things-with-records" id="organizing-things-with-records">Organizing Things with Records</a></h2>
<h3><a class="header" href="#making-a-plan" id="making-a-plan">Making a Plan</a></h3>
<p>As we've said, our game is going to need the following:</p>
<ul>
<li>objects</li>
<li>places</li>
<li>place data (description, exits)</li>
<li>object locations</li>
<li>player location</li>
</ul>
<p>We need to create a data structure to hold all of that, so that it can be passed to functions which need one or more bits of that data. As we mentioned when we talked about Non-Global State, The data structure we're going to use is the LFE <em>record</em>. A <em>record</em> is a simple data structure that lets us associate keys and values.</p>
<p>Let's attack this problem in pieces; we can start with the big picture, and then fill that in.</p>
<h3><a class="header" href="#game-state" id="game-state">Game State</a></h3>
<p>Let's create the over-arching record definition for our game state:</p>
<pre><code class="language-lisp">(defrecord state
  objects
  places
  player-location
  goals)
</code></pre>
<p>We've just defined a record called <code>state</code> that has four fields: <code>objects</code>, <code>places</code>, <code>player-location</code>, and <code>goals</code>.</p>
<h3><a class="header" href="#objects" id="objects">Objects</a></h3>
<p>For each object in the game, we need to know its name and location:</p>
<pre><code class="language-lisp">(defrecord object
  name
  location)
</code></pre>
<p>Let's create some objects now, improving upon our initial &quot;objects&quot; exploration:</p>
<pre><code class="language-lisp">&gt; (set objects
    (list (make-object name 'whiskey-bottle location 'living-room)
          (make-object name 'bucket location 'living-room)
          (make-object name 'frog location 'garden)
          (make-object name 'chain location 'garden)))
</code></pre>
<pre><code class="language-lisp">(#(object whiskey-bottle living-room)
 #(object bucket living-room)
 #(object frog garden)
 #(object chain garden))
</code></pre>
<p>You are probably wondering where that mysterious <code>make-object</code> function came from. When you create a record in LFE, LFE creates several functions dynamically, just for use with your record: their names start with or have as part of their own names, the record name you used. For example, when you created the <code>state</code> and <code>object</code> records, LFE created the <code>make-state</code> and <code>make-object</code> functions (among several others -- more later).</p>
<h3><a class="header" href="#places-and-exits" id="places-and-exits">Places and Exits</a></h3>
<p>Now that we've defined some objects in our world, we're on our way towards describing our world. But there's more to go, still. Our next goal is to create a record for our places:</p>
<pre><code class="language-lisp">(defrecord place
  name
  description
  exits)
</code></pre>
<p>Great! Now we can define our places ... almost. What's the &quot;exit&quot; business? Well, if we're going to move about from place to place, we need to know what direction to go in, the object that lets us pass from one location to the next, and the final destination. Let's create another record for this data:</p>
<pre><code class="language-lisp">(defrecord exit
  direction
  object
  destination)
</code></pre>
<p><em>Now</em> we're ready to create our places!</p>
<pre><code class="language-lisp">&gt; (set living-room
    (make-place
      name 'living-room
      description (++ &quot;You are in the living-room of a wizard's house. &quot;
                      &quot;There is a wizard snoring loudly on the couch.&quot;)
      exits (list
              (make-exit
                direction &quot;west&quot;
                object &quot;door&quot;
                destination 'garden)
              (make-exit
                direction &quot;upstairs&quot;
                object &quot;stairway&quot;
                destination 'attic))))
</code></pre>
<pre><code class="language-lisp">#(place living-room
  &quot;You are in the living-room of a wizard's house. There is a wizard snoring loudly on the couch.&quot;
  (#(exit &quot;west&quot; &quot;door&quot; garden) #(exit &quot;upstairs&quot; &quot;stairway&quot; attic)))
</code></pre>
<p>As you can see above, we have records being created inside records: the <code>living-room</code> record has two exits in it, and we just created those <code>exit</code> records when created the living room's <code>place</code> record.</p>
<p>Something else new: the <code>++</code> function. This is the function for combining two lists in LFE, and since strings and lists are actually the same exact data type, it's also what you use to concatenate strings.</p>
<p>Three more to go!</p>
<pre><code class="language-lisp">&gt; (set garden
    (make-place
      name 'garden
      description (++ &quot;You are in a beautiful garden. &quot;
                      &quot;There is a well in front of you.&quot;)
      exits (list
              (make-exit
                direction &quot;east&quot;
                object &quot;door&quot;
                destination 'living-room))))
</code></pre>
<pre><code class="language-lisp">#(place garden
  &quot;You are in a beautiful garden. There is a well in front of you.&quot;
  (#(exit &quot;east&quot; &quot;door&quot; living-room)))
</code></pre>
<pre><code class="language-lisp">&gt; (set attic
    (make-place
      name 'attic
      description (++ &quot;You are in the attic of the wizard's house. &quot;
                      &quot;There is a giant welding torch in the corner.&quot;)
      exits (list
              (make-exit
                direction &quot;downstairs&quot;
                object &quot;stairway&quot;
                destination 'living-room))))
</code></pre>
<pre><code class="language-lisp">#(place attic
  &quot;You are in the attic of the wizard's house. There is a giant welding torch in the corner.&quot;
  (#(exit &quot;downstairs&quot; &quot;stairway&quot; living-room)))
</code></pre>
<pre><code class="language-lisp">&gt; (set netherworld
    (make-place
      name 'netherworld
      description (++ &quot;Everything is misty and vague. &quot;
                      &quot;You seem to be in the netherworld.\n&quot;
                      &quot;There are no exits.\n&quot;
                      &quot;You could be here for a long, long time ...&quot;)
      exits '()))
</code></pre>
<p>This may seem like a lot of overhead, but it means that things will be much
cleaner and less susceptible to bugs: each item of data is well-defined, with functions that create the data, access the data, and update the data -- both the &quot;magical&quot; record functions mentioned above as well as functions defined in the Erlang standard library (e.g., the <code>proplists</code> and <code>orddict</code> modules).</p>
<p>Furthermore, this is a common practice used in many real-world Erlang and LFE applications: records are passed as inputs to functions and returned as (often updated) outputs, which in turn are fed into other functions.</p>
<h3><a class="header" href="#goals" id="goals">Goals</a></h3>
<p>We're going to have a couple of puzzles in our game and a final task to accomplish, once these puzzles are solved. Let's define the goal record:</p>
<pre><code class="language-lisp">(defrecord goal
  name
  achieved?)
</code></pre>
<p>Now the goals:</p>
<pre><code class="language-lisp">&gt; (set goals
    (list (make-goal name 'weld-chain achieved? 'false)
          (make-goal name 'dunk-bucket achieved? 'false)
          (make-goal name 'splash-wizard achieved? 'false)))
</code></pre>
<pre><code class="language-lisp">(#(goal weld-chain false)
 #(goal dunk-bucket false)
 #(goal splash-wizard false))
</code></pre>
<p>Now that we have our records, let's put them together!</p>

                </main>

                <nav class="nav-wrapper" aria-label="Page navigation">
                    <!-- Mobile navigation buttons -->
                    
                    <a rel="prev" href="../part4/index.html" class="mobile-nav-chapters previous"
                        title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    

                    
                    <a rel="next" href="../part4/2-map.html" class="mobile-nav-chapters next"
                        title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                    

                    <div style="clear: both"></div>
                </nav>
            </div>
        </div>

        <nav class="nav-wide-wrapper" aria-label="Page navigation">
            
            <a rel="prev" href="../part4/index.html" class="nav-chapters previous" title="Previous chapter"
                aria-label="Previous chapter" aria-keyshortcuts="Left">
                <i class="fa fa-angle-left"></i>
            </a>
            

            
            <a rel="next" href="../part4/2-map.html" class="nav-chapters next" title="Next chapter"
                aria-label="Next chapter" aria-keyshortcuts="Right">
                <i class="fa fa-angle-right"></i>
            </a>
            
        </nav>

    </div>

    
    <!-- Livereload script (if served using the cli tool) -->
    <script type="text/javascript">
        var socket = new WebSocket("ws://localhost:3000/__livereload");
        socket.onmessage = function (event) {
            if (event.data === "reload") {
                socket.close();
                location.reload();
            }
        };

        window.onbeforeunload = function () {
            socket.close();
        }
    </script>
    

    
    <!-- Google Analytics Tag -->
    <script type="text/javascript">
        var localAddrs = ["localhost", "127.0.0.1", ""];

        // make sure we don't activate google analytics if the developer is
        // inspecting the book locally...
        if (localAddrs.indexOf(document.location.hostname) === -1) {
            (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date(); a = s.createElement(o),
                m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
            })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

            ga('create', 'UA-38274766-4', 'auto');
            ga('send', 'pageview');
        }
    </script>
    

    

    
    <script type="text/javascript">
        window.playground_copyable = true;
    </script>
    

    

    
    <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
    

    <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
    <script src="../book.js" type="text/javascript" charset="utf-8"></script>

    <!-- Custom JS scripts -->
    

    

</body>

</html>
